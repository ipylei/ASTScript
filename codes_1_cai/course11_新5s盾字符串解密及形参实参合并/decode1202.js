const file = require('fs');
const parser = require("@babel/parser");
const traverse = require("@babel/traverse").default;
const types = require("@babel/types");
const template = require("@babel/template").default;
const generator = require("@babel/generator").default;

//将源代码解析为AST
process.argv.length > 2 ? encodeFile = process.argv[2] : encodeFile = "./encode.js";
process.argv.length > 3 ? decodeFile = process.argv[3] : decodeFile = "./decodeResult.js";


let sourceCode = file.readFileSync(encodeFile, { encoding: "utf-8" });
let ast = parser.parse(sourceCode);

console.time("处理完毕，耗时");


function c(a, d, e) {
    return e = b(), c = function (f, g, h) {
      return f = f - 456, h = e[f], h;
    }, c(a, d);
  }
  
  
!function (d, e, f, fV) {
    for (fV = c, f = d(); !![];) try {
      var g;
      if (g = -parseInt(fV(508)) / 1 * (-parseInt(fV(536)) / 2) + parseInt(fV(924)) / 3 + -parseInt(fV(855)) / 4 + -parseInt(fV(669)) / 5 * (-parseInt(fV(1054)) / 6) + -parseInt(fV(935)) / 7 * (parseInt(fV(808)) / 8) + -parseInt(fV(554)) / 9 * (parseInt(fV(1058)) / 10) + -parseInt(fV(640)) / 11 * (-parseInt(fV(849)) / 12), g === e) break;else f.push(f.shift());
    } catch (h) {
      f.push(f.shift());
    }
  }(b, 147752)  
  
function b(hO) {
    return hO = 'wIhWH{eBZKz{jPtfB{toUpperCase{challenge-stage{eMGtO{cLt{ysQEi{ObSGQ{readyState{</div>{CtmYS{#trk_jschal_js{GTuGI{onfYk{console{8nZKzjN{CfJbT{KXayx{olvgY{innerText{-spinner-allow-5-secs{sendRequest{alaAC{wnlvE{onerror{KvzuK{NSotV{GSuuU{atrKG{transientError{invalid_embedded{spinner-redirecting{sWwWS{tuGWY{position{QIQvp{type{wNEyP{AJJpG{</span></div></div>{TyDkB{spacer{POjdQ{CAEDX{TvpBf{xWUKD{botnets can be used to shutdown popular websites?{explainer_text{</div></div>{POST{loaded{LuNRQ{mbMLQ{send{gXSHo{QsScu{1410060LpsYLw{Message: {VoyGf{EJdhU{Math{proxied_challenge{939012yWljFj{YHTZG{akGVG{keeping your browser up to date will help protect you from malware and other digital attacks?{unspun{ie-container{matchMedia{NnxVn{-spinner-please-wait{click{wiLjV{show{JBFwZ{ZAPxS{RtQU4j3Aphwmige7cvCKuElz1VDJZfTH+sBYMq8NdbP9$yaGn0O-rFL62XkIWSo5x{DGBsh{getElementsByTagName{navigator{vZtKh{cookieEnabled{LPWpV{eQApv{crMho{CpANZ{awmIa{userAgent{parentNode{MOeqI{RrrIf{join{dEkkt{-please-wait{czgvt{bots historically made up nearly 40% of all Internet traffic?{QLTQK{eCogu{BDfbd{YrlAp{color{%E6%97%A0%E6%95%88%E5%9F%9F%E3%80%82%E5%A6%82%E6%9E%9C%E6%AD%A4%E9%97%AE%E9%A2%98%E4%BB%8D%E7%84%B6%E5%AD%98%E5%9C%A8%EF%BC%8C%E8%AF%B7%E4%B8%8E%E7%AB%99%E7%82%B9%E7%AE%A1%E7%90%86%E5%91%98%E8%81%94%E7%B3%BB%E3%80%82{qWlEy{wLVwD{</div><div class="core-msg spacer">{core-msg{toLowerCase{qZVtQ{invalid_sitekey{URGHW{YzUPP{cTplB{STuxl{VlcIQ{yIzMI{_cf_chl_done_ran{cRq{FAfUM{9999999999{JXJZj{random{acNLJ{fVPZv{qbZxP{vyyIg{setTime{Microsoft.XMLHTTP{hUooO{3|5|0|7|2|6|8|1|4|9{%E7%A1%AE%E8%AE%A4%E6%82%A8%E6%98%AF%E7%9C%9F%E4%BA%BA{</p></div>{553746WAckOk{absolute{UPqXI{0123456789abcdef{human_button_text{FOrpN{KTOTZ{matches{ckhCE{%E6%AD%A4%E6%A3%80%E6%9F%A5%E8%8A%B1%E8%B4%B9%E7%9A%84%E6%97%B6%E9%97%B4%E6%AF%94%E9%A2%84%E6%9C%9F%E7%9A%84%E8%A6%81%E9%95%BF%E3%80%82%20%E5%A6%82%E6%9E%9C%E9%97%AE%E9%A2%98%E4%BB%8D%E7%84%B6%E5%AD%98%E5%9C%A8%EF%BC%8C%E8%AF%B7%E6%A3%80%E6%9F%A5%E6%82%A8%E7%9A%84%20Internet%20%E8%BF%9E%E6%8E%A5%E5%B9%B6%E5%88%B7%E6%96%B0%E9%A1%B5%E9%9D%A2%E3%80%82{Vvbdi{1325345RyMDJs{_cf_chl_ctx{OkOot{add{nJAhD{error code: 1020{1|0|2|3|5|4{challenge-success{cached-challenge-warning{font-red{<span class="fact-title">{NUICf{mYayd{xRMAX{facts{HQqoN{https://cloudflare.hcaptcha.com/1/api.js?endpoint=https%3A%2F%2Fcloudflare.hcaptcha.com&assethost=https%3A%2F%2Fcf-assets.hcaptcha.com&imghost=https%3A%2F%2Fcf-imgs.hcaptcha.com&{lAIiI{URL: {YNIRU{parseInt{GlGJj{PElJB{ihrBr{400px{idCdH{zzSkr{script error{MdhVU{challenge-explainer-expandable{hostname{AVlAy{button{Line: {getTemplateVersion{input{keydown{syhKS{%E5%83%B5%E5%B0%B8%E7%BD%91%E7%BB%9C%E5%8F%AF%E4%BB%A5%E8%AE%A9%E7%83%AD%E9%97%A8%E7%BD%91%E7%AB%99%E5%81%9C%E5%B7%A5%EF%BC%9F{explainer_title{floor{stringify{XwRyl{now{LKxsB{GYUGn{padding{showAuxiliaryContent{chlApivId{transform{nsjbP{hLchM{borderImage{-content"><p style="background-color: #de5052; border-color: #521010; color: #fff;" class="{Please enable Cookies and reload the page.{success{qtVhK{gqVAs{Invalid domain. Contact the Site Administrator if this problem persists.{FTmuk{HXziN{Content-type{showOverlay{facts_4{IKHeq{NZXef{sEMyp{visibility{FGhqX{oApCd{Xhwut{height{success_text{success_title{xYLOY{stage{gbVKD{fVOFk{kZVRt{RIJdj{alert{QMXyR{CUERI{GnPQu{BsTWC{jffrz{flow/ov{hbycS{PqYgk{Tqpzr{src{MpBlr{lvPBr{Error object: {eVNbK{facts_6{JkmQG{nigIJ{xSwcn{getTime{min{xtYzy{FVgNG{azmav{Did you know{Uczab{NabDd{hasOwnProperty{dSlpN{value{jLlpP{ZeATx{passive{VLFNR{</span>{sfdnt{justifyContent{cookies_missing{VRKcF{1233294NsInwf{HPlvZ{PCfWS{kraZX{440860bRrQQZ{qWppk{api_show_dbg_info{addFatalAPIError{facts_1{ErlBH{not_embedded{ksmft{fromCharCode{qYKfe{lds-ring{mmxWd{top{Invalid sitekey. Contact the Site Administrator if this problem persists.{body{disableUiWithMessage{ViafA{remove{challenge-spinner{cFwnx{interactive{KIRtF{DXoOn{uNIhS{ojtZO{EXxvO{Column: {DODQq{WthnE{YzSXA{application/x-www-form-urlencoded{EZNbx{push{nkcpu{qVJhq{EUTER{dfueR{%E4%BB%8E%E5%8E%86%E5%8F%B2%E6%95%B0%E6%8D%AE%E6%9D%A5%E7%9C%8B%EF%BC%8C%E8%87%AA%E5%8A%A8%E7%A8%8B%E5%BA%8F%E5%8D%A0%E4%BA%86%E6%89%80%E6%9C%89%20Internet%20%E6%B5%81%E9%87%8F%E7%9A%84%E8%BF%91%2040%25%EF%BC%9F{uKukZ{uPXpo{nhJeo{yrbXm{big-button{opacity{consolas,"Liberation Mono",courier,monospace{ontimeout{pCumM{VLXnd{protocol{eQuuL{%E6%AD%A4%E8%B4%A8%E8%AF%A2%E9%A1%B5%E9%9D%A2%E8%A2%AB%E6%9F%90%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%84%8F%E5%A4%96%E7%BC%93%E5%AD%98%EF%BC%8C%E4%B8%8D%E5%86%8D%E5%8F%AF%E7%94%A8%E3%80%82{OQdvl{UatcT{challenge-form{wcGbe{wUkQp{NnmQP{flex{SMEXk{trk_jschal_js{iNcZc{pointermove{aRfoV{dKPUY{0.5{jDPci{<div class="expandable-title" id="challenge-explainer-summary"><button class="expandable-summary-btn" id="challenge-explainer-btn" type="button">{SdLwT{/0.0686318979566254:1669723539:sMA6UTmnBypE5tUE2MSPNOSAG--SQemwc4zsEpfk1IA/{kaaGS{JijdR{LbIgp{cNounce{RhkWg{split{fontSize{SUuah{%E6%97%A0%E6%B3%95%E9%80%9A%E8%BF%87%E6%AD%A4%E5%9C%B0%E5%9D%80%E8%AE%BF%E9%97%AE%E6%AD%A4%20Web%20%E8%B5%84%E4%BA%A7%E3%80%82{kSrfl{CCVKC{43%25%20%E7%9A%84%E7%BD%91%E7%BB%9C%E6%94%BB%E5%87%BB%E6%98%AF%E4%BB%A5%E5%B0%8F%E5%9E%8B%E4%BC%81%E4%B8%9A%E4%B8%BA%E7%9B%AE%E6%A0%87%EF%BC%9F{prototype{dPWOU{WBOaw{MJrDT{branding{GMaZG{fontFamily{ojVwO{This challenge page was accidentally cached by an intermediary and is no longer available.{cf_chl_rc_m{bpDJc{GTZoW{verifying-text{iYPHz{number{PCkPj{Qzaiy{%E4%BB%85%E7%94%A8%E4%BA%8E%E6%B5%8B%E8%AF%95{qxeOJ{wWZwt{Why am I seeing this page?{oQizr{eHuik{HUcDn{kIuXU{lwLkv{challenge-fact-wrapper{RLWLU{undefined{<div class="cf-content"><p style="background-color: #de5052; border-color: #521010; color: #fff;" class="cf-alert cf-alert-error">{spinner{_cf_chl_opt{Proceeding...{no-cookie-warning{SiNrC{cEMXy{tLhhb{cFPWv{createElement{%E7%BB%A7%E7%BB%AD%E2%80%A6{WSkso{LmKMu{red{setAttribute{cvId{fWcNE{huDiA{%2b{SfqTP{expanded{fact{classList{fail{AFbri{Connection is secure{facts_8{jiCAC{Hrjwn{hidden{api_fail{lXffC{iASxT{expandable{outdated_browser{head{PHkTk{</p>{hTXbw{xUeHO{open{the first botnet in 2003 took over 500-1000 devices? Today, botnets take over millions of devices at once.{AjddD{CF-Challenge{rVgIh{browser_not_supported{vFtWH{facts_7{zMuDv{facts_title{ofPXu{check_delays{AOBtC{data-translate{ioiHD{SHA256{ffs{XEbOF{cHash{Requests from malicious bots can pose as legitimate traffic. Occasionally, you may see this page while the site ensures that the connection is secure.{avwEj{toUTCString{fAQZL{OcYkR{mousemove{lwHWt{OXqPO{TUXbB{UdeMY{2003%20%E5%B9%B4%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%83%B5%E5%B0%B8%E7%BD%91%E7%BB%9C%E6%8E%A5%E7%AE%A1%E4%BA%86%20500-1000%20%E5%8F%B0%E8%AE%BE%E5%A4%87%EF%BC%9F%E8%80%8C%E4%BB%8A%E5%A4%A9%EF%BC%8C%E5%83%B5%E5%B0%B8%E7%BD%91%E7%BB%9C%E4%B8%80%E6%AC%A1%E5%8F%AF%E4%BB%A5%E6%8E%A5%E7%AE%A1%E6%95%B0%E4%BB%A5%E7%99%BE%E4%B8%87%E8%AE%A1%E7%9A%84%E8%AE%BE%E5%A4%87%E3%80%82{<div id="qr">{location-mismatch-warning{chC{_cf_chl_done{replace{pow-button{facts_5{Internet%20%E4%B8%8A%E5%85%81%E8%AE%B8%E4%BD%BF%E7%94%A8%E7%BB%8F%E8%BF%87%E9%AA%8C%E8%AF%81%E7%9A%84%E8%87%AA%E5%8A%A8%E7%A8%8B%E5%BA%8F%EF%BC%8C%E5%9B%A0%E4%B8%BA%E5%AE%83%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%B8%AE%E5%8A%A9%E6%8F%90%E4%BE%9B%E6%88%91%E4%BB%AC%E6%97%A5%E5%B8%B8%E4%BD%BF%E7%94%A8%E7%9A%84%E6%9C%8D%E5%8A%A1%EF%BC%9F{85YugIvA{This browser is not supported{DOMContentLoaded{lHExt{qCLLR{challenge-running{%27%E4%B8%8D%E6%94%AF%E6%8C%81%E6%AD%A4%E6%B5%8F%E8%A7%88%E5%99%A8{wfCQX{pDvpJ{clear{10 em{NdBla{substring{ncYgI{call{5px{getElementById{SHBRf{This challenge must be embedded into a parent page.{Date{MMTes{status{nrcjc{iTsaB{bootstrap{UsPmv{fAkBL{pointerover{2548XuBKhO{challenge-body-text{QpgCX{GaGxO{cTTimeMs{PorLx{ydBhw{center{alignItems{KTgdt{%E6%AD%A4%E8%B4%A8%E8%AF%A2%E5%BF%85%E9%A1%BB%E5%B5%8C%E5%85%A5%E7%88%B6%E9%A1%B5%E9%9D%A2%E3%80%82{Awujv{facts_{setRequestHeader{pcdFk{MOtfP{companies are using machine learning to help identify and protect against bot traffic?{nextSibling{9DcZJlU{visible{text-gray-600{NzBWk{RGaJT{isDarkMode{addEventListener{complete{charCodeAt{gTlvr{removeEventListener{<p class="{jrjyv{%E5%90%84%E5%85%AC%E5%8F%B8%E9%83%BD%E5%9C%A8%E4%BD%BF%E7%94%A8%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%9D%A5%E5%B8%AE%E5%8A%A9%E8%AF%86%E5%88%AB%E5%92%8C%E9%98%B2%E5%BE%A1%E8%87%AA%E5%8A%A8%E7%A8%8B%E5%BA%8F%E6%B5%81%E9%87%8F%EF%BC%9F{setTimeout{%E8%AE%A9%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BF%9D%E6%8C%81%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E5%8F%AF%E4%BB%A5%E5%B8%AE%E5%8A%A9%E6%82%A8%E9%98%B2%E8%8C%83%E6%81%B6%E6%84%8F%E8%BD%AF%E4%BB%B6%E5%92%8C%E5%85%B6%E4%BB%96%E6%95%B0%E5%AD%97%E6%94%BB%E5%87%BB%EF%BC%9F{BqxIE{ryvHg{swnrO{bold{script{WVgPj{MooKu{pscve{location{OINxm{GTuWi{</span> <span id="challenge-fact" class="body-text">{TNPzc{enter{bupcK{cookie{uwvfG{VNmvy{mlMre{aeegQ{cTplV{jerXd{JSYHK{cxHZz{yGebi{sjiOW{Khtml Ms O Moz Webkit{Device verification complete. Redirecting...{ZaPPW{wrGNM{This check is taking longer than expected. Check your Internet connection and refresh the page if the issue persists.{pSTfu{qZqCp{JZOur{xTqVH{some signs of bot malware on your computer are computer crashes, slow Internet, and a slow computer?{removeChild{IEfyM{redirect{HVHpI{test{expires={GIdhr{yuLOk{HioYO{ - {onreadystatechange{DqRhp{div{pQYjI{attachEvent{wxFRR{querySelector{WBUFF{zETqs{appendChild{length{toggle{spinner-icon{<div id="challenge-error-title"><div class="h2"><span class="icon-wrapper"><img class="heading-icon" alt="Warning icon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAMAAADypuvZAAAAPFBMVEUAAACvDwOyDwKyDwOvEACyDgOyDwKvDwKwDgCyDgKxDgOyDgKvDgKyDwKyDgOxDgKzDgKxDgKxEASyDwMgW5ZmAAAAE3RSTlMAQN+/EJDvMB9wYJ9Qz7CAf6CAtGoj/AAAAcFJREFUSMeVltu2gyAMRLlfBDxt+f9/PTq2VXSwmod2GdhkEoIiiPmYinK1VqXt4MUFk9bVxlTyvxBdienhNoJwoYMY+57hdMzBTA4v4/gRaykT1FuLNI0/j/1g3i2IJ8s9F+owNCx+2UlWQXbexQFjjTjN1/lGALS9xIm9QIXNOoowlFKrFssYTtmvuOXpp2HtT6lUE3f11bH1IQu9qbYUBEr7yq8zCxkWuva8+rtF4RrkP6ESxFPoj7rtW30+jI4UQlZuiejEwZ4cMg65RKjjUDz6NdwWvxw6nnLESEAl230O5cldUAdy8P44hJZTYh40DOIKzFw3QOI6hPk9aDiFHJc3nMirKERgEPd7FKKgiy5DEn3+5JsrAfHNtfjVRLucTPTaCA1rxFVz6AX8yYsIUlXoMqbPWFUeXF1Cyqz7Ej1PAXNBs1B1tsKWKpsX0yFhslTetL4mL8s4j2fyslTbjbT7Va2V7GCG5ukhftijXdsoQhGmzSI4QhHGhVufz4QJ/v6Hug6dK0EK3YuM8/3Lx5h3Z0STywe55oxRejM5Qo4aAtZ8eTBuWp6dl3IXgfnnLpyzBCFctHomnSopejLhH/3AMfEMndTJAAAAAElFTkSuQmCC"></span><span id="challenge-error-text">{block{rVbFR{oxYQy{JQVIG{<div class="{MiJtW{btAiN{KORbf{cursor{NNdZB{11XUcmDw{=; Max-Age=-99999999;{veuIP{GjJDt{error{QOCcX{;path=/{KQZJa{beacon/ov{kTYWG{TAnnC{VfRTc{%E7%AB%99%E7%82%B9%E5%AF%86%E9%92%A5%E6%97%A0%E6%95%88%E3%80%82%E5%A6%82%E6%9E%9C%E6%AD%A4%E9%97%AE%E9%A2%98%E4%BB%8D%E7%84%B6%E5%AD%98%E5%9C%A8%EF%BC%8C%E8%AF%B7%E4%B8%8E%E7%AB%99%E7%82%B9%E7%AE%A1%E7%90%86%E5%91%98%E8%81%94%E7%B3%BB%E3%80%82{wAMPj{facts_2{className{zkEOx{8px{/cdn-cgi/challenge-platform/{ActiveXObject{get{CLKDK{pow{end{EGDcP{GboRK{kvRdn{auto{YHhPo{5viAiPT{[[[ERROR]]]:{render=explicit&recaptchacompat=off&onload=_cf_chl_hload{api_success{bubbles{testing_only{fnQNj{prefix{-alert-error">{vRVPQ{darkmode{0|2|4|3|1{nawBe{NiTeI{1|3|2|4|0{vOKxd{yEKjB{RcIqC{body-text{timeout{(prefers-color-scheme: dark){XMLHttpRequest{GYDAC{msg{atob{width{fontWeight{insertBefore{NKTHM{reload{UaadU{none{IBKII{failureTimeout{rizOe{onclick{gcIjl{XijTR{eKRrt{<svg width="92" height="38" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="m58.615 37.432.44-1.485c.522-1.766.328-3.4-.55-4.6-.808-1.105-2.154-1.756-3.788-1.832l-30.96-.386a.617.617 0 0 1-.487-.254.604.604 0 0 1-.067-.546.823.823 0 0 1 .72-.538l31.247-.387c3.706-.166 7.719-3.107 9.124-6.694l1.782-4.553a1.03 1.03 0 0 0 .07-.387.992.992 0 0 0-.022-.215C64.1 6.655 55.98 0 46.267 0c-8.948 0-16.545 5.648-19.27 13.498-1.759-1.291-4.009-1.977-6.427-1.74-4.294.417-7.743 3.797-8.17 7.995a8.816 8.816 0 0 0 .236 3.129C5.624 23.082 0 28.7 0 35.606c0 .625.048 1.24.138 1.84.044.291.295.51.596.51l57.158.007c.005 0 .01-.003.016-.003a.75.75 0 0 0 .707-.528Z" fill="#F6821F"/><path d="M68.93 16.49c-.288 0-.573.008-.858.022a.492.492 0 0 0-.134.028.487.487 0 0 0-.312.321l-1.217 4.112c-.523 1.767-.329 3.4.55 4.6.807 1.106 2.153 1.755 3.787 1.831l6.6.387c.194.01.366.102.47.25.111.157.136.358.07.55a.824.824 0 0 1-.718.537l-6.858.387c-3.723.168-7.736 3.108-9.141 6.694l-.496 1.267c-.09.229.078.473.326.485l.018.002h23.597c.281 0 .532-.18.608-.444.41-1.426.629-2.928.629-4.482 0-9.139-7.576-16.547-16.921-16.547Z" fill="#FBAD41"/><path d="M90.475 38c-.844 0-1.527-.667-1.527-1.492 0-.82.683-1.487 1.527-1.487.842 0 1.525.667 1.525 1.487 0 .825-.683 1.492-1.525 1.492Zm0-2.704c-.676 0-1.224.544-1.224 1.212a1.22 1.22 0 0 0 1.224 1.217 1.22 1.22 0 0 0 1.221-1.217c0-.668-.548-1.212-1.221-1.212Zm.77 2h-.362l-.304-.573h-.408v.568h-.316v-1.64h.804c.354 0 .577.21.577.536 0 .235-.139.424-.349.498l.358.61Zm-.581-.858c.13 0 .26-.066.26-.25 0-.187-.1-.252-.26-.252h-.493v.502h.493Z" fill="#222"/></svg>{LHhSC{zIndex{ltsho{responseText{2px{YPphR{cType{zrLZP{Verify you are human{-alert {%E6%9D%A5%E8%87%AA%E6%81%B6%E6%84%8F%E8%87%AA%E5%8A%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E8%AF%B7%E6%B1%82%E5%8F%AF%E8%83%BD%E4%BC%9A%E4%BC%AA%E8%A3%85%E6%88%90%E5%90%88%E6%B3%95%E6%B5%81%E9%87%8F%E3%80%82%E6%9C%89%E6%97%B6%EF%BC%8C%E5%9C%A8%E7%AB%99%E7%82%B9%E8%A6%81%E7%A1%AE%E4%BF%9D%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%E6%97%B6%EF%BC%8C%E6%82%A8%E5%8F%AF%E8%83%BD%E4%BC%9A%E7%9C%8B%E5%88%B0%E6%AD%A4%E9%A1%B5%E9%9D%A2%E3%80%82{PwGYu{indexOf{log{akckM{XFfYi{margin{apply{Testing only.{span{display{Function{noSaA{%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%B4%A9%E6%BA%83%E3%80%81Internet%20%E9%80%9F%E5%BA%A6%E5%8F%98%E6%85%A2%E3%80%81%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%80%9F%E5%BA%A6%E5%8F%98%E6%85%A2%EF%BC%8C%E8%BF%99%E4%BA%9B%E9%83%BD%E6%98%AF%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B8%8A%E5%AD%98%E5%9C%A8%E8%87%AA%E5%8A%A8%E7%A8%8B%E5%BA%8F%E6%81%B6%E6%84%8F%E8%BD%AF%E4%BB%B6%E7%9A%84%E8%BF%B9%E8%B1%A1%EF%BC%9F{getUiBrandedSnippet{style{IojPb{hide{zadVv{inline{XnxLw{charAt{DLcCA{uxaTA{SdORo{qajmi{KonoT{invalid_domain{ZFLJA{aqdTr{nNdkX{_cf_chl_hload{43% of cyber attacks target small businesses?{fweqV{OsbFN{MjwSb{zbSNF{pIYaH{#cf-challenge-running{_cf_chl_hlep{cf_chl_{mhPTY{chCAS{innerHTML{_cf_chl_enter{cRay{MooHG{jdc{QdThq{pointer{BQvVt{ELKvh{sFVtF{MiPrt{_cf_chl_hloaded{touchstart{GRoZR{Proxy{SPbyi{IBLDz{assign{BKVnU{href{PMuaw{facts_3{xrYbR{document{LLtrH{<span class="caret-icon-wrapper"> <div class="caret-icon"></div> </span> </button> </div> <div class="expandable-details" id="challenge-explainer-details">{getBrandPrefix{yVYao{chReq{gbioi'.split('{'), b = function () {
      return hO;
    }, b();
  }  


let funcNames = ['c'];

const callToString = 
{
	AssignmentExpression(path)
	{
		let {node,scope} = path;
		
		let {left,operator,right} = node;
		
		if (!types.isIdentifier(left) || operator != "=" || !types.isIdentifier(right))
		{
			return;
		}
		
		if (!funcNames.includes(right.name))
		{
			return;
		}
		
		let binding =  scope.getBinding(left.name);
		 
		if (!binding) return;

		let {constantViolations,referencePaths} = binding;

		if (constantViolations.length != 1) return;
		let  flag  = false;
		for (let referPath of referencePaths)
		{
			let parentPath = referPath.parentPath;
			if (parentPath.isAssignmentExpression({"right":referPath.node,"operator":"="}))
			{
				funcNames.push(left.name);
				continue;
			}

			
			let {arguments} = parentPath.node;
			

			let value = c(arguments[0].value);
		  console.log(parentPath.toString(),"--->",value);
			
			parentPath.replaceWith(types.valueToNode(value));
			
			flag = true;
			
		}
		
		flag && path.remove();

	},
	
}


traverse(ast,callToString);



let VAR_NODE = template(`var A = B;`);

const restoreParams = 
{
	CallExpression(path)
	{
		let {callee,arguments} = path.node;
		
		if (!types.isFunctionExpression(callee) || arguments.length == 0)
		{
			return;
		}
		
		let {body,params} = callee;
		
		body = body.body;
		
		 if (arguments.length > params.length ) return;
		
		for (let i = arguments.length-1; i>=0;i--)   //实参的个数可能小于形参的个数
		{
			let newNode = VAR_NODE({"A":params[i],"B":arguments[i]});
			body.unshift(newNode);
			
		}
		
		let len = arguments.length-1;
		
		path.node.arguments = [];
		
		path.node.callee.params = path.node.callee.params.slice(arguments.length);
		

		console.log(path.toString());

	},
}

traverse(ast,restoreParams);



const resolveForInit = 
{
	ForStatement(path)
	{
		let {init} = path.node;
		if (types.isSequenceExpression(init))
		{
			let expressionNode = types.expressionStatement(init);
			path.insertBefore(expressionNode);
			path.node.init = null;
		}
	},
	IfStatement(path)
	{
		let {test} = path.node;
		if (types.isSequenceExpression(test))
		{
			let expressions = test.expressions;
			path.node.test = expressions.pop();
			for (let expression of expressions)
			{
				
				path.insertBefore(types.ExpressionStatement(expression));
			}
			
		}		
		
	}
}

traverse(ast, resolveForInit);

ast = parser.parse(generator(ast).code);

const removeDeadParams = 
{
	
	"FunctionDeclaration|FunctionExpression"(path)
	{
		if (path.toString().includes("arguments"))
		{//①
			return;
		}
		
		let paramsPath = path.get('params');
		
		for (let eachPath of paramsPath)
		{
			if (!eachPath.isIdentifier())
			{//②
				continue;
			}
			let {node,scope} = eachPath;
			let binding = scope.getBinding(node.name); 
			if(!binding.referenced && binding.constant)
			{//③
				eachPath.remove();
				scope.crawl();
			}
		}
	}
}


traverse(ast, removeDeadParams);



const resolveSequence = 
{
	SequenceExpression(path)
	{
		let {scope,parentPath,node} = path;
		let expressions = node.expressions;
		if (parentPath.isReturnStatement({"argument":node}))
		{
			let lastExpression = expressions.pop();
			for (let expression of expressions)
			{
				parentPath.insertBefore(types.ExpressionStatement(expression=expression));
			}
			
			path.replaceInline(lastExpression);
		}
		else if (parentPath.isExpressionStatement({"expression":node}))
		{
			let body = [];
			expressions.forEach(express=>{
      body.push(types.ExpressionStatement(express));
    });
   path.replaceInline(body);
		}
		else
		{
			return;
		}
		
		scope.crawl();
	}
}


traverse(ast, resolveSequence);

ast = parser.parse(generator(ast).code);

const visitParams = 
{
	FunctionDeclaration(path)
	{
		if (path.toString().includes("arguments"))
		{//①
			return;
		}
		
		let paramsPath = path.get('params');
		
		for (let i = paramsPath.length - 1; i>=0; i--)
		{
			if (!paramsPath[i].isIdentifier())
			{//②
				break;;
			}
			
			let {node,scope} = paramsPath[i];
			let binding = scope.getBinding(node.name); 
			let {constantViolations,referencePaths} = binding;
			
			if (constantViolations.length < 1 || !constantViolations[0].isAssignmentExpression() ||
			   !constantViolations[0].parentPath.isExpressionStatement()) 
			{
				break;
			}
			
			let {left,operator,right} = constantViolations[0].node;
			
			if (left.name != node.name || operator != "=") 
			{//确保 其改变是左边开始。
				return;
			}

			let {start,end} = constantViolations[0].node;  //用来判断 其改变的地方再所用引用它地方的前面
			
			let flag = false;
			
			for (let referPath of referencePaths)
			{
				if (referPath.node.end < start)
				{//如果引用的地方在改变的地方之前，不能做操作。
					flag = true;
					break;
				}
			}
			
			if (flag)
			{
				break;
			}
			
			
			let newNode = VAR_NODE({"A":node,"B":right});
			constantViolations[0].parentPath.replaceWith(newNode);
			
			paramsPath[i].remove();
			
			
		}
		

		
	}
}

traverse(ast, visitParams);



console.timeEnd("处理完毕，耗时");


let {code} = generator(ast,opts = {jsescOption:{"minimal":true}});

file.writeFile(decodeFile, code, (err) => { });